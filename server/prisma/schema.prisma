generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(uuid())
  username  String     @unique
  password  String
  role      ROLE       @default(EMPLOYEE)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  customer  Customer[]
}

enum ROLE {
  MANAGER
  EMPLOYEE
}

model Customer {
  id                      String       @id @default(uuid())
  surname                 String
  firstname               String
  lastname                String
  gender                  String
  birthdate               DateTime
  civilRegistrationNumber String       @unique
  register                String       @unique
  marriageStatus          String
  familyMembers           Int
  education               String
  employment              String
  city                    String
  district                String
  khoroo                  String
  address                 String
  monthlyIncome           Int
  phone                   Json
  email                   String
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt
  createdBy               String
  user                    User         @relation(fields: [createdBy], references: [id])
  collateral              Collateral[]
  lend                    Lend[]
}

model AssetType {
  id           Int            @id @default(autoincrement())
  name         String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  subAssetType SubAssetType[]
  collateral   Collateral[]
}

model SubAssetType {
  id               Int          @id @default(autoincrement())
  name             String
  assetType        AssetType    @relation(fields: [assetTypeId], references: [id])
  assetTypeId      Int
  additionalFields Json[]
  collateral       Collateral[]
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
}

model Collateral {
  id               Int          @id @default(autoincrement())
  ownerId          String
  owner            Customer     @relation(fields: [ownerId], references: [id])
  assetTypeId      Int
  assetType        AssetType    @relation(fields: [assetTypeId], references: [id])
  subAssetTypeId   Int
  subAssetType     SubAssetType @relation(fields: [subAssetTypeId], references: [id])
  collateralName   String
  state            String
  quantity         Int
  depositAmount    Int
  marketValue      Int
  dateOfAssessment DateTime
  description      String
  additionalFields Json
}

model Lend {
  id            Int      @id @default(autoincrement())
  accountNumber Int
  debtorId      String
  debtor        Customer @relation(fields: [debtorId], references: [id])
  interestRate  Int
  loanAmount    Int
  termOfLoan    Int
  startDate     DateTime
  endDate       DateTime
}
